/**
 * Compatibility CSS
 * 
 * Print styles, reduced motion, cross-browser compatibility, parallax sections, and Gutenberg editor styles
 *
 * @package Kunaal_Theme
 * @since 4.20.8
 */

/* ========================================
   REDUCED MOTION
   ======================================== */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  .card:hover, .card:focus-visible { transform: none; box-shadow: none; }
  .media img, .media svg, .avatar img { transform: none !important; --py: 0px !important; --ps: 1 !important; }
  h2::after { animation: none !important; transform: scaleX(1); }
  .sectionHead { animation: none !important; opacity: 1; transform: none; }
  .reveal, .reveal-left, .reveal-right { opacity: 1 !important; transform: none !important; }
}

/* ========================================
   PRINT STYLES
   ======================================== */
@media print {
  .mast, .progress, .actionDock, .sharePanel, .subscribePanel, .navToggle, .filterToggle, .filterPanel { display: none !important; }
  body { padding-top: 0; }
  .card { break-inside: avoid; }
  .media img { filter: none; }
  /* EXCEPTION: Print styles use text-decoration for accessibility (no animations in print) */
  /* This is an acceptable exception to the link underline contract */
  a { text-decoration: underline; }
  .prose a::after { content: " (" attr(href) ")"; font-size: 0.8em; color: var(--muted); }
}

/* ========================================
   GUTENBERG BLOCK EDITOR STYLES
   ======================================== */
.wp-block { max-width: var(--prose); }
.wp-block[data-align="wide"] { max-width: var(--wide); }
.wp-block[data-align="full"] { max-width: none; }

/* ========================================
   CROSS-BROWSER COMPATIBILITY
   ======================================== */
/* Safari flexbox fixes */
.grid, .toolbar, .filterPanel {
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
}

/* Firefox scrollbar styling */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--hair) transparent;
}

/* Safari backdrop-filter fallback */
@supports not (backdrop-filter: blur(10px)) {
  .overlay { background: color-mix(in srgb, var(--ink) 25%, transparent); }
  .mast { background: var(--bg); }
  /* Dark mode fallback - use same gray as header.css */
  :root[data-theme="dark"] .mast { background: rgba(26, 26, 26, 0.95); }
}

/* Edge smooth scroll fix */
@supports (-ms-ime-align: auto) {
  html { scroll-behavior: auto; }
}

/* iOS momentum scrolling */
.topicDropdown, .ledger {
  -webkit-overflow-scrolling: touch;
}

/* Prevent iOS zoom on inputs */
@media screen and (max-width: 768px) {
  input, select, textarea {
    font-size: 16px !important;
  }
}

/* Fix Safari button styling */
button, .filterToggle, .topicDropdownBtn {
  -webkit-appearance: none;
  appearance: none;
}

/* ========================================
   PARALLAX SECTIONS
   ======================================== */
.parallax-section {
  position: relative;
  min-height: 60vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.parallax-bg {
  position: absolute;
  inset: -20%;
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  z-index: 0;
}

/* Disable parallax on mobile for performance */
@media (max-width: 768px), (hover: none) {
  .parallax-bg,
  .parallax-hero,
  .parallax-split-image {
    background-attachment: scroll !important;
  }
}

.parallax-content {
  position: relative;
  z-index: 1;
  max-width: var(--prose);
  padding: var(--space-6);
}

/* ========================================
   DARK MODE MASTHEAD BACKGROUND
   
   100% opaque to block the blue body gradient from bleeding through.
   Uses token-based colors via CSS variables.
   ======================================== */
[data-theme="dark"] .mast,
[data-theme="dark"] header.mast {
  background: var(--k-color-bg) !important;
  border-bottom-color: var(--k-color-hair) !important;
}

/* Mobile nav dropdown - match mast background */
[data-theme="dark"] .mast .nav,
[data-theme="dark"] .nav {
  background: var(--k-color-bg) !important;
  border-color: var(--k-color-hair) !important;
}

/* ========================================
   NAV LINKS - Token-based styling
   
   Let utilities.css handle underline animation via tokens:
   - Light mode: var(--k-underline-blue-color) falls back to var(--blue)
   - Dark mode: var(--k-underline-blue-color) = #E8A87C (orange)
   
   We only set colors and ensure NO background-color on any state.
   ======================================== */

/* Dark mode nav link colors */
[data-theme="dark"] .mast .nav a,
[data-theme="dark"] .nav a {
  color: var(--k-color-ink) !important;
}

/* ALL nav links: ensure no background-color (let underline work) */
.mast .nav a,
.nav a {
  background-color: transparent !important;
}

/* Hover/focus: no background-color, underline animates via utilities.css */
.mast .nav a:hover,
.mast .nav a:focus-visible,
.nav a:hover,
.nav a:focus-visible {
  background-color: transparent !important;
}

/* Current item: no background-color, underline visible via utilities.css */
.mast .nav a.current,
.nav a.current {
  background-color: transparent !important;
}

/* Dark mode nav toggle color */
[data-theme="dark"] .mast .navToggle,
[data-theme="dark"] .navToggle {
  color: var(--k-color-ink) !important;
}

/* ========================================
   EDGE FORCED DARK MODE FIX
   Prevent Edge from applying its own color adjustments
   which can cause blue tint on dark mode elements.
   See: https://developer.mozilla.org/en-US/docs/Web/CSS/forced-color-adjust
   ======================================== */
.mast,
header.mast,
.mast .nav,
.nav a {
  forced-color-adjust: none;
  -ms-high-contrast-adjust: none; /* Legacy Edge support */
}

