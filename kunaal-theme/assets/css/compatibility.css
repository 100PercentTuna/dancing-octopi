/**
 * Compatibility CSS
 * 
 * Print styles, reduced motion, cross-browser compatibility, parallax sections, and Gutenberg editor styles
 *
 * @package Kunaal_Theme
 * @since 4.20.8
 */

/* ========================================
   REDUCED MOTION
   ======================================== */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  .card:hover, .card:focus-visible { transform: none; box-shadow: none; }
  .media img, .media svg, .avatar img { transform: none !important; --py: 0px !important; --ps: 1 !important; }
  h2::after { animation: none !important; transform: scaleX(1); }
  .sectionHead { animation: none !important; opacity: 1; transform: none; }
  .reveal, .reveal-left, .reveal-right { opacity: 1 !important; transform: none !important; }
}

/* ========================================
   PRINT STYLES
   ======================================== */
@media print {
  .mast, .progress, .actionDock, .sharePanel, .subscribePanel, .navToggle, .filterToggle, .filterPanel { display: none !important; }
  body { padding-top: 0; }
  .card { break-inside: avoid; }
  .media img { filter: none; }
  /* EXCEPTION: Print styles use text-decoration for accessibility (no animations in print) */
  /* This is an acceptable exception to the link underline contract */
  a { text-decoration: underline; }
  .prose a::after { content: " (" attr(href) ")"; font-size: 0.8em; color: var(--muted); }
}

/* ========================================
   GUTENBERG BLOCK EDITOR STYLES
   ======================================== */
.wp-block { max-width: var(--prose); }
.wp-block[data-align="wide"] { max-width: var(--wide); }
.wp-block[data-align="full"] { max-width: none; }

/* ========================================
   CROSS-BROWSER COMPATIBILITY
   ======================================== */
/* Safari flexbox fixes */
.grid, .toolbar, .filterPanel {
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
}

/* Firefox scrollbar styling */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--hair) transparent;
}

/* Safari backdrop-filter fallback */
@supports not (backdrop-filter: blur(10px)) {
  .overlay { background: color-mix(in srgb, var(--ink) 25%, transparent); }
  .mast { background: var(--bg); }
  /* Dark mode fallback - use same gray as header.css */
  :root[data-theme="dark"] .mast { background: rgba(26, 26, 26, 0.95); }
}

/* Edge smooth scroll fix */
@supports (-ms-ime-align: auto) {
  html { scroll-behavior: auto; }
}

/* iOS momentum scrolling */
.topicDropdown, .ledger {
  -webkit-overflow-scrolling: touch;
}

/* Prevent iOS zoom on inputs */
@media screen and (max-width: 768px) {
  input, select, textarea {
    font-size: 16px !important;
  }
}

/* Fix Safari button styling */
button, .filterToggle, .topicDropdownBtn {
  -webkit-appearance: none;
  appearance: none;
}

/* ========================================
   PARALLAX SECTIONS
   ======================================== */
.parallax-section {
  position: relative;
  min-height: 60vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.parallax-bg {
  position: absolute;
  inset: -20%;
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  z-index: 0;
}

/* Disable parallax on mobile for performance */
@media (max-width: 768px), (hover: none) {
  .parallax-bg,
  .parallax-hero,
  .parallax-split-image {
    background-attachment: scroll !important;
  }
}

.parallax-content {
  position: relative;
  z-index: 1;
  max-width: var(--prose);
  padding: var(--space-6);
}

/* ========================================
   DARK MODE MASTHEAD BACKGROUND
   
   100% opaque to block the blue body gradient from bleeding through.
   Uses token-based colors via CSS variables.
   ======================================== */
[data-theme="dark"] .mast,
[data-theme="dark"] header.mast {
  background: var(--k-color-bg) !important;
  border-bottom-color: var(--k-color-hair) !important;
}

/* Mobile nav dropdown - match mast background */
[data-theme="dark"] .mast .nav,
[data-theme="dark"] .nav {
  background: var(--k-color-bg) !important;
  border-color: var(--k-color-hair) !important;
}

/* ========================================
   NAV LINKS - EDGE/IE COMPATIBILITY FIX
   
   PROBLEM: Edge renders background-image gradient as FULL FILL instead
   of respecting background-size: 100% 2px (which should be a 2px underline).
   
   ROOT CAUSE: display: inline on links causes background-size percentage
   calculations to behave differently across browsers.
   
   SOLUTION:
   1. Force display: inline-block for predictable sizing
   2. Explicitly set ALL background properties
   3. Use !important to override any conflicting rules
   ======================================== */

/* Base nav link fix - force inline-block for Edge compatibility */
.nav a {
  display: inline-block !important; /* EDGE FIX: inline-block has predictable background sizing */
  forced-color-adjust: none !important;
  -ms-high-contrast-adjust: none !important;
}

/* Dark mode nav link - COMPLETE BACKGROUND OVERRIDE */
[data-theme="dark"] .mast .nav a,
[data-theme="dark"] .nav a {
  color: var(--k-color-ink, #f0f0f0) !important;
  display: inline-block !important;
  /* FULL background reset - prevents any fill */
  background: transparent !important;
  background-color: transparent !important;
  background-image: linear-gradient(#E8A87C, #E8A87C) !important; /* Hardcoded orange for Edge */
  background-repeat: no-repeat !important;
  background-position: 0 100% !important;
  background-size: 0% 2px !important; /* Hidden by default */
}

/* Dark mode hover/focus - show 2px underline */
[data-theme="dark"] .mast .nav a:hover,
[data-theme="dark"] .mast .nav a:focus-visible,
[data-theme="dark"] .nav a:hover,
[data-theme="dark"] .nav a:focus-visible {
  background: transparent !important;
  background-color: transparent !important;
  background-image: linear-gradient(#E8A87C, #E8A87C) !important;
  background-repeat: no-repeat !important;
  background-position: 0 100% !important;
  background-size: 100% 2px !important; /* 2px underline at bottom */
}

/* Dark mode current - show 2px underline */
[data-theme="dark"] .mast .nav a.current,
[data-theme="dark"] .nav a.current {
  background: transparent !important;
  background-color: transparent !important;
  background-image: linear-gradient(#E8A87C, #E8A87C) !important;
  background-repeat: no-repeat !important;
  background-position: 0 100% !important;
  background-size: 100% 2px !important; /* 2px underline at bottom */
}

/* Dark mode nav toggle color */
[data-theme="dark"] .mast .navToggle,
[data-theme="dark"] .navToggle {
  color: var(--k-color-ink, #f0f0f0) !important;
}

/* ========================================
   LIGHT MODE NAV - Same fix for consistency
   ======================================== */
.mast .nav a,
.nav a {
  display: inline-block !important;
}

/* Light mode hover/focus/current - blue underline */
html:not([data-theme="dark"]) .mast .nav a:hover,
html:not([data-theme="dark"]) .mast .nav a:focus-visible,
html:not([data-theme="dark"]) .nav a:hover,
html:not([data-theme="dark"]) .nav a:focus-visible {
  background: transparent !important;
  background-color: transparent !important;
  background-image: linear-gradient(#1E5AFF, #1E5AFF) !important; /* Blue in light mode */
  background-repeat: no-repeat !important;
  background-position: 0 100% !important;
  background-size: 100% 2px !important;
}

html:not([data-theme="dark"]) .mast .nav a.current,
html:not([data-theme="dark"]) .nav a.current {
  background: transparent !important;
  background-color: transparent !important;
  background-image: linear-gradient(#1E5AFF, #1E5AFF) !important;
  background-repeat: no-repeat !important;
  background-position: 0 100% !important;
  background-size: 100% 2px !important;
}

/* ========================================
   EDGE/IE FORCED COLOR MODE OVERRIDE
   ======================================== */
.mast,
header.mast,
.mast .nav,
.nav a {
  forced-color-adjust: none !important;
  -ms-high-contrast-adjust: none !important;
}

