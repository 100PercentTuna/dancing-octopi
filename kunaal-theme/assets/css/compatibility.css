/**
 * Compatibility CSS
 * 
 * Print styles, reduced motion, cross-browser compatibility, parallax sections, and Gutenberg editor styles
 *
 * @package Kunaal_Theme
 * @since 4.20.8
 */

/* ========================================
   REDUCED MOTION
   ======================================== */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  .card:hover, .card:focus-visible { transform: none; box-shadow: none; }
  .media img, .media svg, .avatar img { transform: none !important; --py: 0px !important; --ps: 1 !important; }
  h2::after { animation: none !important; transform: scaleX(1); }
  .sectionHead { animation: none !important; opacity: 1; transform: none; }
  .reveal, .reveal-left, .reveal-right { opacity: 1 !important; transform: none !important; }
}

/* ========================================
   PRINT STYLES
   ======================================== */
@media print {
  .mast, .progress, .actionDock, .sharePanel, .subscribePanel, .navToggle, .filterToggle, .filterPanel { display: none !important; }
  body { padding-top: 0; }
  .card { break-inside: avoid; }
  .media img { filter: none; }
  /* EXCEPTION: Print styles use text-decoration for accessibility (no animations in print) */
  /* This is an acceptable exception to the link underline contract */
  a { text-decoration: underline; }
  .prose a::after { content: " (" attr(href) ")"; font-size: 0.8em; color: var(--muted); }
}

/* ========================================
   GUTENBERG BLOCK EDITOR STYLES
   ======================================== */
.wp-block { max-width: var(--prose); }
.wp-block[data-align="wide"] { max-width: var(--wide); }
.wp-block[data-align="full"] { max-width: none; }

/* ========================================
   CROSS-BROWSER COMPATIBILITY
   ======================================== */
/* Safari flexbox fixes */
.grid, .toolbar, .filterPanel {
  -webkit-flex-wrap: wrap;
  flex-wrap: wrap;
}

/* Firefox scrollbar styling */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--hair) transparent;
}

/* Safari backdrop-filter fallback */
@supports not (backdrop-filter: blur(10px)) {
  .overlay { background: color-mix(in srgb, var(--ink) 25%, transparent); }
  .mast { background: var(--bg); }
  /* Dark mode fallback - use same gray as header.css */
  :root[data-theme="dark"] .mast { background: rgba(26, 26, 26, 0.95); }
}

/* Edge smooth scroll fix */
@supports (-ms-ime-align: auto) {
  html { scroll-behavior: auto; }
}

/* iOS momentum scrolling */
.topicDropdown, .ledger {
  -webkit-overflow-scrolling: touch;
}

/* Prevent iOS zoom on inputs */
@media screen and (max-width: 768px) {
  input, select, textarea {
    font-size: 16px !important;
  }
}

/* Fix Safari button styling */
button, .filterToggle, .topicDropdownBtn {
  -webkit-appearance: none;
  appearance: none;
}

/* ========================================
   PARALLAX SECTIONS
   ======================================== */
.parallax-section {
  position: relative;
  min-height: 60vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.parallax-bg {
  position: absolute;
  inset: -20%;
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  z-index: 0;
}

/* Disable parallax on mobile for performance */
@media (max-width: 768px), (hover: none) {
  .parallax-bg,
  .parallax-hero,
  .parallax-split-image {
    background-attachment: scroll !important;
  }
}

.parallax-content {
  position: relative;
  z-index: 1;
  max-width: var(--prose);
  padding: var(--space-6);
}

/* ========================================
   DARK MODE MASTHEAD - NUCLEAR OVERRIDE
   
   This MUST win over everything. Uses maximum specificity.
   
   PROBLEM: header.css has warm hover background with !important
   SOLUTION: Use even higher specificity selectors here
   
   Masthead background: neutral gray rgba(26, 26, 26, 0.95)
   Nav hover background: NONE (transparent)
   ======================================== */

/* Masthead background - MAXIMUM SPECIFICITY */
html:root[data-theme="dark"] .mast,
html:root[data-theme="dark"] header.mast,
html[data-theme="dark"] .mast,
html[data-theme="dark"] header.mast,
:root[data-theme="dark"] .mast,
:root[data-theme="dark"] header.mast,
body[data-theme="dark"] .mast,
body.dark-mode .mast,
[data-theme="dark"] .mast {
  background: rgba(26, 26, 26, 0.95) !important;
  background-color: rgba(26, 26, 26, 0.95) !important;
  border-bottom-color: rgba(201, 184, 168, 0.2) !important;
}

/* Mobile nav dropdown - match mast exactly */
html:root[data-theme="dark"] .mast .nav,
html:root[data-theme="dark"] .nav,
html[data-theme="dark"] .mast .nav,
html[data-theme="dark"] .nav,
:root[data-theme="dark"] .mast .nav,
:root[data-theme="dark"] .nav,
[data-theme="dark"] .mast .nav,
[data-theme="dark"] .nav {
  background: rgba(26, 26, 26, 0.98) !important;
  background-color: rgba(26, 26, 26, 0.98) !important;
  border-color: rgba(201, 184, 168, 0.2) !important;
}

/* Nav links in dark mode */
html:root[data-theme="dark"] .mast .nav a,
html:root[data-theme="dark"] .nav a,
html[data-theme="dark"] .mast .nav a,
html[data-theme="dark"] .nav a,
:root[data-theme="dark"] .mast .nav a,
:root[data-theme="dark"] .nav a,
[data-theme="dark"] .mast .nav a,
[data-theme="dark"] .nav a {
  color: #f0f0f0 !important;
  background-image: linear-gradient(#E8A87C, #E8A87C) !important;
  background-color: transparent !important;
}

/* ========================================
   NAV HOVER - NUCLEAR NO-BACKGROUND OVERRIDE
   
   MUST beat header.css rgba(232, 168, 124, 0.1) !important
   Using even higher specificity selectors.
   ======================================== */

/* Dark mode hover - NO BACKGROUND */
html:root[data-theme="dark"] .mast .nav a:hover,
html:root[data-theme="dark"] .mast .nav a:focus-visible,
html:root[data-theme="dark"] .nav a:hover,
html:root[data-theme="dark"] .nav a:focus-visible,
html[data-theme="dark"] .mast .nav a:hover,
html[data-theme="dark"] .mast .nav a:focus-visible,
html[data-theme="dark"] .nav a:hover,
html[data-theme="dark"] .nav a:focus-visible,
:root[data-theme="dark"] .mast .nav a:hover,
:root[data-theme="dark"] .mast .nav a:focus-visible,
:root[data-theme="dark"] .nav a:hover,
:root[data-theme="dark"] .nav a:focus-visible,
[data-theme="dark"] .mast .nav a:hover,
[data-theme="dark"] .mast .nav a:focus-visible,
[data-theme="dark"] .nav a:hover,
[data-theme="dark"] .nav a:focus-visible {
  color: #f0f0f0 !important;
  background-color: transparent !important;
  background: transparent !important;
}

/* Dark mode current item - NO BACKGROUND */
html:root[data-theme="dark"] .mast .nav a.current,
html:root[data-theme="dark"] .nav a.current,
html[data-theme="dark"] .mast .nav a.current,
html[data-theme="dark"] .nav a.current,
:root[data-theme="dark"] .mast .nav a.current,
:root[data-theme="dark"] .nav a.current,
[data-theme="dark"] .mast .nav a.current,
[data-theme="dark"] .nav a.current {
  color: #f0f0f0 !important;
  background-color: transparent !important;
  background: transparent !important;
}

/* Nav toggle */
html:root[data-theme="dark"] .mast .navToggle,
html:root[data-theme="dark"] .navToggle,
html[data-theme="dark"] .mast .navToggle,
html[data-theme="dark"] .navToggle,
:root[data-theme="dark"] .mast .navToggle,
:root[data-theme="dark"] .navToggle {
  color: #f0f0f0 !important;
}

/* ========================================
   LIGHT MODE NAV HOVER - ALSO NO BACKGROUND
   Ensures underline-only interaction in light mode too.
   ======================================== */
html .mast .nav a:hover,
html .mast .nav a:focus-visible,
html .nav a:hover,
html .nav a:focus-visible,
.mast .nav a:hover,
.mast .nav a:focus-visible,
.nav a:hover,
.nav a:focus-visible {
  background-color: transparent !important;
  background: none !important;
}

/* ========================================
   EDGE FORCED DARK MODE FIX
   Prevent Edge from applying its own color adjustments
   which can cause blue tint on dark mode elements.
   See: https://developer.mozilla.org/en-US/docs/Web/CSS/forced-color-adjust
   ======================================== */
.mast,
header.mast,
.mast .nav,
.nav a {
  forced-color-adjust: none;
  -ms-high-contrast-adjust: none; /* Legacy Edge support */
}

