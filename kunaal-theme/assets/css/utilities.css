/* ========================================
   UTILITIES - Progress Bar, Lazy Loading, Animations
   ======================================== */

/* CSS Cascade Layers */
@layer tokens, base, utilities, components, blocks;

@layer utilities {
/* ========================================
   PROGRESS BAR
   ======================================== */
.progress {
  position: fixed;
  top: 0;
  left: 0;
  height: 3px;
  width: 100%;
  z-index: 9999;
  pointer-events: none;
  background: rgba(30,90,255,0.1);
}
.progressFill {
  height: 100%;
  width: 0%;
  background: var(--blue);
  box-shadow: 0 0 10px rgba(30,90,255,.4);
  transition: width 250ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* ========================================
   LAZY LOADING - Skeleton Placeholders
   ======================================== */
[data-lazy-block] {
  position: relative;
  min-height: 200px;
}

[data-lazy-block].is-loading {
  pointer-events: none;
}

[data-lazy-block].is-loading::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    var(--bg-alt) 25%,
    var(--bg) 50%,
    var(--bg-alt) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s infinite;
  border-radius: 8px;
  z-index: 1;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

[data-lazy-block].is-loaded::before {
  display: none;
}

[data-lazy-block].is-error {
  border: 2px dashed var(--hair);
  padding: var(--space-4);
  text-align: center;
  color: var(--muted);
}

.lazy-block-error {
  padding: var(--space-3);
  background: var(--bg-alt);
  border: 1px solid var(--hair);
  border-radius: 6px;
  color: var(--muted);
  font-size: 14px;
}

@media (prefers-reduced-motion: reduce) {
  [data-lazy-block].is-loading::before {
    animation: none;
  }
}

/* ========================================
   DOUBLE UNDERLINE MOTIF - Canonical Implementation
   ======================================== */
  /**
   * Double underline utility: thick blue line over thin gray line
   * 
   * Token-driven implementation:
   * - Gray line via text-decoration (reliable across line breaks)
   * - Blue line via background gradient positioned above gray
   * - Works on inline links and spans
   * - Supports multi-line wrapping with box-decoration-break
   * - Maintains accessible focus states
   */
  .u-underline-double {
    display: inline;
    text-decoration: underline;
    text-decoration-color: var(--k-underline-gray-color, var(--hair2));
    text-decoration-thickness: var(--k-underline-gray-thickness, 1px);
    text-underline-offset: var(--k-underline-gray-offset, 0px);
    background-image: linear-gradient(
      var(--k-underline-blue-color, var(--blue)),
      var(--k-underline-blue-color, var(--blue))
    );
    background-repeat: no-repeat;
    background-position: 0 calc(100% + var(--k-underline-blue-offset, -1px));
    background-size: 0% var(--k-underline-blue-thickness, 2px);
    padding-bottom: calc(var(--k-underline-blue-thickness, 2px) + 1px);
    box-decoration-break: clone;
    transition: background-size 280ms cubic-bezier(0.4, 0, 0.2, 1) 40ms;
  }

  .u-underline-double:hover,
  .u-underline-double:focus-visible {
    background-size: 100% var(--k-underline-blue-thickness, 2px);
  }

  /* Global link underline - canonical implementation using :where() for low specificity */
  :where(.nav a, .footer a, .prose a:not([class*="button"]):not([class*="btn"]), .articleMeta a, .mailWrap, .say-hello-text a) {
    display: inline;
    text-decoration: underline;
    text-decoration-color: var(--k-underline-gray-color, var(--hair2));
    text-decoration-thickness: var(--k-underline-gray-thickness, 1px);
    text-underline-offset: var(--k-underline-gray-offset, 0px);
    background-image: linear-gradient(
      var(--k-underline-blue-color, var(--blue)),
      var(--k-underline-blue-color, var(--blue))
    );
    background-repeat: no-repeat;
    background-position: 0 calc(100% + var(--k-underline-blue-offset, -1px));
    background-size: 0% var(--k-underline-blue-thickness, 2px);
    padding-bottom: calc(var(--k-underline-blue-thickness, 2px) + 1px);
    box-decoration-break: clone;
    transition: background-size 280ms cubic-bezier(0.4, 0, 0.2, 1) 40ms;
  }

  :where(.nav a, .footer a, .prose a:not([class*="button"]):not([class*="btn"]), .articleMeta a, .mailWrap, .say-hello-text a):hover,
  :where(.nav a, .footer a, .prose a:not([class*="button"]):not([class*="btn"]), .articleMeta a, .mailWrap, .say-hello-text a):focus-visible {
    background-size: 100% var(--k-underline-blue-thickness, 2px);
  }

  /* Nav-specific: letter spacing on hover */
  :where(.nav a):hover,
  :where(.nav a):focus-visible,
  :where(.nav a.current) {
    letter-spacing: .01em;
  }

  /* Block style class mapping (for Gutenberg block styles) */
  .is-style-double-underline {
    display: inline;
    text-decoration: underline;
    text-decoration-color: var(--k-underline-gray-color, var(--hair2));
    text-decoration-thickness: var(--k-underline-gray-thickness, 1px);
    text-underline-offset: var(--k-underline-gray-offset, 0px);
    background-image: linear-gradient(
      var(--k-underline-blue-color, var(--blue)),
      var(--k-underline-blue-color, var(--blue))
    );
    background-repeat: no-repeat;
    background-position: 0 calc(100% + var(--k-underline-blue-offset, -1px));
    background-size: 100% var(--k-underline-blue-thickness, 2px);
    padding-bottom: calc(var(--k-underline-blue-thickness, 2px) + 1px);
    box-decoration-break: clone;
  }

  .is-style-double-underline:hover,
  .is-style-double-underline:focus-visible {
    /* Already at 100% - no transition needed for block style */
  }

  /* Section heading underline motif - canonical implementation */
  .u-section-underline {
    position: relative;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--k-underline-gray-color, var(--hair2));
  }

  .u-section-underline::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -1px; /* Position to overlap the border-bottom */
    width: 40px;
    height: var(--k-underline-blue-thickness, 2px);
    background: var(--k-underline-blue-color, var(--blue));
    transform-origin: left;
    transform: scaleX(0);
    animation: growLine 600ms ease 350ms forwards;
    z-index: 2; /* Ensure blue line is above the border */
  }

  @keyframes growLine {
    from { transform: scaleX(0); }
    to { transform: scaleX(1); }
  }

  /* Legacy single blue underline (deprecated - use .u-underline-double) */
  .uBlue {
    display: inline-block;
    background-image: linear-gradient(var(--blue), var(--blue));
    background-repeat: no-repeat;
    background-position: 0 100%;
    background-size: 0% 2px;
    padding-bottom: 2px;
    transition: background-size 240ms cubic-bezier(0.4,0,0.2,1) 40ms, 
                color 240ms cubic-bezier(0.4,0,0.2,1), 
                letter-spacing 200ms cubic-bezier(0.4,0,0.2,1);
  }
  .uBlue:hover, .uBlue:focus-visible, .uBlue.current {
    background-size: 100% 2px;
    letter-spacing: .01em;
  }

/* ========================================
   SCREEN READER ONLY
   ======================================== */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border: 0;
}
} /* End utilities layer */

